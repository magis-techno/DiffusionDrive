# ğŸ”„ åŠ¨æ€å…ƒç´ æ›´æ–°ä¿®å¤

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·å‘ç°æ»‘åŠ¨çª—å£GIFä¸­å­˜åœ¨ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š**è™½ç„¶è½¨è¿¹åœ¨è¿ç»­é¢„æµ‹ï¼Œä½†å…¶ä»–å¯è§†åŒ–å…ƒç´ æ²¡æœ‰éšå¸§å˜åŒ–è€Œæ›´æ–°**ã€‚

### å…·ä½“é—®é¢˜
- **ä¿¡æ¯é¢æ¿**: æ˜¾ç¤ºçš„æ˜¯é™æ€ä¿¡æ¯ï¼Œæ²¡æœ‰å®æ—¶æ›´æ–°å½“å‰å¸§çš„è½¦é€Ÿã€ä½ç½®ç­‰
- **BEVä¸­çš„åŠ¨æ€ç›®æ ‡**: å…¶ä»–è½¦è¾†ã€è¡Œäººä½ç½®å›ºå®šï¼Œæ²¡æœ‰éšæ—¶é—´ç§»åŠ¨
- **è‡ªè½¦çŠ¶æ€**: è‡ªè½¦åœ¨BEVä¸­çš„ä½ç½®å’Œæœå‘æ²¡æœ‰å®Œå…¨åŒæ­¥æ›´æ–°
- **æ‘„åƒå¤´å›¾åƒ**: å¯èƒ½æ˜¾ç¤ºçš„æ˜¯ç¬¬ä¸€å¸§çš„å›¾åƒï¼Œè€Œä¸æ˜¯å½“å‰å¸§
- **å‚è€ƒè½¨è¿¹**: GTå’ŒPDMè½¨è¿¹æ²¡æœ‰åŸºäºå½“å‰æ—¶é—´è¿›è¡Œåˆ‡ç‰‡

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¼ æ„Ÿå™¨æ•°æ®å®æ—¶æ›´æ–°

**ä¿®å¤ä½ç½®**: `visualizer.py:_render_sliding_bev_view()`

**é—®é¢˜**: ä½¿ç”¨å›ºå®šçš„scene_dataä¸­çš„ä¼ æ„Ÿå™¨æ•°æ®
```python
# ä¿®å¤å‰ âŒ
scene_data["sensors"]["lidar"][0]  # å›ºå®šç¬¬ä¸€å¸§çš„LiDAR

# ä¿®å¤å âœ…  
current_lidar = None
lidar_sensors = [sensor for sensor in current_frame.sensors if hasattr(sensor, 'lidar')]
if lidar_sensors:
    current_lidar = lidar_sensors[0].lidar
```

**æ•ˆæœ**: æ¯å¸§éƒ½ä½¿ç”¨å½“å‰æ—¶åˆ»çš„LiDARæ•°æ®

### 2. åŠ¨æ€ç‰©ä½“å¯è§†åŒ–

**æ–°å¢åŠŸèƒ½**: `visualizer.py:_add_dynamic_objects_to_bev()`

**å®ç°**: 
- ä»å½“å‰å¸§çš„agent_inputä¸­æå–åŠ¨æ€ç‰©ä½“ä¿¡æ¯
- ç»˜åˆ¶å…¶ä»–è½¦è¾†ğŸŸ  (æ©™è‰²æ–¹å—)ã€è¡ŒäººğŸ”´ (çº¢è‰²åœ†ç‚¹)
- æ˜¾ç¤ºè‡ªè½¦ä½ç½®ğŸŸ¦ (è“è‰²æ˜Ÿå½¢) + æœå‘ç®­å¤´
- æ”¯æŒåæ ‡ç³»è½¬æ¢ (NavSim BEV mapping)

```python
# åŠ¨æ€ç‰©ä½“ç±»å‹è¯†åˆ«
if 'vehicle' in str(agent.type).lower():
    color, marker = 'orange', 's'    # æ©™è‰²æ–¹å—
elif 'pedestrian' in str(agent.type).lower():
    color, marker = 'red', 'o'       # çº¢è‰²åœ†ç‚¹
else:
    color, marker = 'purple', '^'    # ç´«è‰²ä¸‰è§’

# è‡ªè½¦æœå‘ç®­å¤´
ax.arrow(ego_x_bev, ego_y_bev, dx_bev, dy_bev,
        head_width=2.0, head_length=1.5, fc='blue', ec='blue')
```

### 3. å®æ—¶çŠ¶æ€ä¿¡æ¯é¢æ¿

**ä¿®å¤ä½ç½®**: `visualizer.py:_render_status_panel()`

**æ–°å¢ä¿¡æ¯**:
- **è½¦é€Ÿ**: km/h å’Œ m/s åŒå•ä½æ˜¾ç¤º
- **ä½ç½®**: å®æ—¶åæ ‡ (X, Y)
- **æœå‘**: å¼§åº¦å’Œè§’åº¦åŒå•ä½
- **åŠ é€Ÿåº¦**: X/Yæ–¹å‘åˆ†é‡
- **æ—¶é—´ä¿¡æ¯**: å¸§æ—¶é—´æˆ³ã€æ—¶é—´å·®

```python
# å®æ—¶é€Ÿåº¦è®¡ç®—
velocity = ego_status.velocity
speed_ms = (velocity.x**2 + velocity.y**2)**0.5
speed_kmh = speed_ms * 3.6

# æœå‘è§’åº¦è½¬æ¢
heading_deg = pose.heading * 180 / 3.14159

status_text = [
    f"ğŸš— Vehicle Status",
    f"  â€¢ Speed: {speed_kmh:.1f} km/h ({speed_ms:.1f} m/s)",
    f"  â€¢ Position: ({pose.x:.1f}, {pose.y:.1f})",
    f"  â€¢ Heading: {pose.heading:.3f} rad ({heading_deg:.1f}Â°)",
    # ...
]
```

### 4. æ‘„åƒå¤´å›¾åƒå®æ—¶æ›´æ–°

**ä¿®å¤ä½ç½®**: `visualizer.py:_render_sliding_camera_view()`

**æ–°å¢åŠŸèƒ½**:
- ç¡®ä¿æ˜¾ç¤ºå½“å‰å¸§çš„æ‘„åƒå¤´å›¾åƒ
- å›¾åƒä¸Šå åŠ æ—¶é—´æ ‡ç­¾ (é»„è‰²èƒŒæ™¯)
- å›¾åƒä¸Šå åŠ é€Ÿåº¦ä¿¡æ¯ (è“è‰²èƒŒæ™¯)
- æ ‡é¢˜æ˜¾ç¤ºå½“å‰æ—¶é—´

```python
# æ—¶é—´å åŠ 
ax.text(0.02, 0.98, f"t = {current_time:.1f}s", 
       bbox=dict(boxstyle="round,pad=0.3", facecolor='yellow', alpha=0.8))

# é€Ÿåº¦å åŠ   
ax.text(0.02, 0.88, f"Speed: {speed_kmh:.1f} km/h",
       bbox=dict(boxstyle="round,pad=0.3", facecolor='lightblue', alpha=0.8))
```

### 5. å‚è€ƒè½¨è¿¹æ—¶é—´åˆ‡ç‰‡

**æ–°å¢åŠŸèƒ½**: `visualizer.py:_slice_trajectory_by_time()`

**å®ç°**:
- æ ¹æ®å½“å‰æ—¶é—´å’Œé¢„æµ‹çª—å£å¯¹GT/PDMè½¨è¿¹è¿›è¡Œåˆ‡ç‰‡
- æ”¯æŒå¤šç§æ—¶é—´æˆ³æ ¼å¼ (time, timestamp, pose.time)
- å®¹é”™å¤„ç†ï¼šå¦‚æœæ²¡æœ‰æ—¶é—´ä¿¡æ¯ï¼Œä½¿ç”¨ç´¢å¼•è¿‘ä¼¼

```python
# æ—¶é—´çª—å£åˆ‡ç‰‡
end_time = current_time + prediction_horizon
for state in trajectory_states:
    if current_time <= state_time <= end_time:
        sliced_states.append(state)
```

**æ•ˆæœ**: GTå’ŒPDMè½¨è¿¹ä¹Ÿä¼šéšå½“å‰æ—¶é—´åŠ¨æ€æ˜¾ç¤ºç›¸åº”ç‰‡æ®µ

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰ âŒ
```
å¸§1: ä¼ æ„Ÿå™¨æ•°æ®â‚ + è½¨è¿¹é¢„æµ‹â‚ + é™æ€ä¿¡æ¯é¢æ¿ + å›ºå®šç‰©ä½“ä½ç½®
å¸§2: ä¼ æ„Ÿå™¨æ•°æ®â‚ + è½¨è¿¹é¢„æµ‹â‚‚ + é™æ€ä¿¡æ¯é¢æ¿ + å›ºå®šç‰©ä½“ä½ç½®  
å¸§3: ä¼ æ„Ÿå™¨æ•°æ®â‚ + è½¨è¿¹é¢„æµ‹â‚ƒ + é™æ€ä¿¡æ¯é¢æ¿ + å›ºå®šç‰©ä½“ä½ç½®
```
**é—®é¢˜**: åªæœ‰è½¨è¿¹åœ¨å˜åŒ–ï¼Œå…¶ä»–å…ƒç´ éƒ½æ˜¯é™æ€çš„

### ä¿®å¤å âœ…
```
å¸§1: ä¼ æ„Ÿå™¨æ•°æ®â‚ + è½¨è¿¹é¢„æµ‹â‚ + å®æ—¶çŠ¶æ€â‚ + åŠ¨æ€ç‰©ä½“â‚ + åˆ‡ç‰‡è½¨è¿¹â‚
å¸§2: ä¼ æ„Ÿå™¨æ•°æ®â‚‚ + è½¨è¿¹é¢„æµ‹â‚‚ + å®æ—¶çŠ¶æ€â‚‚ + åŠ¨æ€ç‰©ä½“â‚‚ + åˆ‡ç‰‡è½¨è¿¹â‚‚
å¸§3: ä¼ æ„Ÿå™¨æ•°æ®â‚ƒ + è½¨è¿¹é¢„æµ‹â‚ƒ + å®æ—¶çŠ¶æ€â‚ƒ + åŠ¨æ€ç‰©ä½“â‚ƒ + åˆ‡ç‰‡è½¨è¿¹â‚ƒ
```
**æ•ˆæœ**: æ‰€æœ‰å…ƒç´ éƒ½éšæ—¶é—´åŠ¨æ€æ›´æ–°ï¼ŒçœŸæ­£æ¨¡æ‹Ÿè¿ç»­é©¾é©¶

## ğŸ§ª æµ‹è¯•éªŒè¯

### å¿«é€Ÿæµ‹è¯•
```bash
cd trajectory_app
python test_dynamic_updates.py
```

### å¯¹æ¯”æµ‹è¯•
è„šæœ¬ä¼šç”Ÿæˆä¸¤ä¸ªGIFï¼š
- **ä¼ ç»Ÿç‰ˆæœ¬**: å›ºå®šä¼ æ„Ÿå™¨æ•°æ®
- **åŠ¨æ€ç‰ˆæœ¬**: å®æ—¶æ›´æ–°æ‰€æœ‰å…ƒç´ 

### è§‚å¯Ÿè¦ç‚¹
1. **BEVä¸­çš„è“è‰²æ˜Ÿå½¢è‡ªè½¦**æ˜¯å¦åœ¨ç§»åŠ¨
2. **è“è‰²ç®­å¤´æœå‘**æ˜¯å¦åœ¨å˜åŒ–  
3. **æ©™è‰²/çº¢è‰²åŠ¨æ€ç‰©ä½“**æ˜¯å¦åœ¨ç§»åŠ¨
4. **æ‘„åƒå¤´å›¾åƒ**æ˜¯å¦åœ¨å˜åŒ– (æ³¨æ„å·¦ä¸Šè§’æ—¶é—´æ ‡ç­¾)
5. **çŠ¶æ€é¢æ¿æ•°å€¼**æ˜¯å¦åœ¨æ›´æ–°
6. **å‚è€ƒè½¨è¿¹**æ˜¯å¦åŸºäºå½“å‰æ—¶é—´åˆ‡ç‰‡

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### ä¿®å¤åçš„è°ƒç”¨æ–¹å¼
```python
# åŠ¨æ€æ›´æ–°ç‰ˆæœ¬ (é»˜è®¤)
result = app.create_sliding_window_gif(
    scene_token="your_scene",
    sampling_rate=2.0,
    total_duration=6.0,
    prediction_horizon=4.0,
    show_history=True,
    fps=4.0
)
```

### è§‚å¯Ÿå»ºè®®
- **å¹¶æ’å¯¹æ¯”**: åŒæ—¶æ’­æ”¾ä¿®å¤å‰åçš„GIF
- **å…³æ³¨ç»†èŠ‚**: æ³¨æ„çŠ¶æ€é¢æ¿ä¸­çš„æ•°å€¼å˜åŒ–
- **éªŒè¯çœŸå®æ€§**: æ£€æŸ¥è‡ªè½¦è¿åŠ¨æ˜¯å¦ç¬¦åˆç‰©ç†è§„å¾‹
- **å¤šåœºæ™¯æµ‹è¯•**: åœ¨ä¸åŒç±»å‹åœºæ™¯ä¸­éªŒè¯æ•ˆæœ

## ğŸ† ä¿®å¤æˆæœ

### âœ… è§£å†³çš„é—®é¢˜
1. âœ… ä¼ æ„Ÿå™¨æ•°æ®å®æ—¶æ›´æ–°
2. âœ… åŠ¨æ€ç‰©ä½“ä½ç½®è·Ÿè¸ª  
3. âœ… è‡ªè½¦çŠ¶æ€å®Œæ•´åŒæ­¥
4. âœ… å®æ—¶ä¿¡æ¯é¢æ¿æ˜¾ç¤º
5. âœ… æ‘„åƒå¤´å›¾åƒæ—¶é—´å åŠ 
6. âœ… å‚è€ƒè½¨è¿¹æ—¶é—´åˆ‡ç‰‡

### ğŸ‰ æœ€ç»ˆæ•ˆæœ
- **çœŸå®é©¾é©¶æ¨¡æ‹Ÿ**: ä¸å†æ˜¯é™æ€æ•°æ®å±•ç¤ºï¼Œè€Œæ˜¯åŠ¨æ€é©¾é©¶è¿‡ç¨‹
- **å®Œæ•´ä¿¡æ¯åŒæ­¥**: æ‰€æœ‰å¯è§†åŒ–å…ƒç´ éƒ½ä¸å½“å‰æ—¶é—´å¸§ä¿æŒä¸€è‡´
- **æ›´å¼ºè§‚å¯Ÿä»·å€¼**: å¯ä»¥çœŸæ­£è§‚å¯Ÿåˆ°è½¦è¾†å’Œç¯å¢ƒçš„æ—¶åºå˜åŒ–
- **æ›´å¥½ç”¨æˆ·ä½“éªŒ**: ç¬¦åˆç›´è§‰çš„åŠ¨æ€å¯è§†åŒ–æ•ˆæœ

---

**ğŸŠ ä¿®å¤å®Œæˆï¼ç°åœ¨æ»‘åŠ¨çª—å£GIFçœŸæ­£å®ç°äº†å®Œæ•´çš„åŠ¨æ€æ›´æ–°ï¼** 